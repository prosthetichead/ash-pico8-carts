pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function _init()
 plr = {
 	gx = 0,
 	gy = 0,
 	menu=false,
 }
 --setup grid
 rows = 14
	cols = 15
	grid = {}
	for i = 0, cols do
		grid[i] = {}
		for j = 0, rows do
			grid[i][j] = {
				s = 3,
				w = true
			}
		end
	end
end

function _update()
 if(not plr.menu) then
  if(btnp(1)) then
  	plr.gx += 1
  elseif(btnp(0)) then
  	plr.gx -= 1
  elseif(btnp(2)) then
   plr.gy -= 1
  elseif(btnp(3)) then
   plr.gy += 1
  elseif(btnp(4)) then
  	reset_menu()
  	plr.menu=true
  end
  plr.gy = mid(0,plr.gy,rows)
  plr.gx = mid(0,plr.gx,cols)
 else
 	u_menu() 	
 end
end

function _draw()
	cls()
	for xi = 0, cols do
		for yi = 0, rows do
			cell = grid[xi][yi]
			spr(cell.s, (xi)*8, (yi)*8)
  end
 end    
	
	--draw player
	spr(1, plr.gx*8, plr.gy*8)
	
	print("plr "..plr.gx, 10, 122, 10)
	
	if plr.menu then
		d_menu()
	end
end


-->8
--enemy


function spawn_enemy()
  local side = flr(rnd(4)) -- pick random side (0-3)
  
  if side == 0 then -- top
    enemy_x = rnd(128)
    enemy_y = 0
  elseif side == 1 then -- right
    enemy_x = 128
    enemy_y = rnd(128)
  elseif side == 2 then -- bottom
    enemy_x = rnd(128)
    enemy_y = 128
  else -- left
    enemy_x = 0
    enemy_y = rnd(128)
  end
end
-->8
--menu
options = {}
opto = {"build","sell","upgrade","info"}
optb = {"arrow","cannon","wall"}
opts = {"yes","no"}
optu = {"power","range","speed"}
opti = {"done"}

option = 1
choice = ""

function reset_menu()
	choice = ""
	option = 1
	options = opto
end

function u_menu()
	if(btnp(4)) then
		choice = choice..options[option]	
 	option = 1
 end
 if(btnp(3)) then
 	option+=1
 elseif(btnp(2)) then
  option-=1
 end
 option = mid(1,option,#options)
 
	if(choice == "build")then
		options = optb
	elseif(choice == "sell")then
		options = opts
	elseif(choice == "upgrade")then
		options = optu
	elseif(choice == "info")then
		options = opti
	elseif(choice == "infodone")then
		plr.menu = false
	elseif(choice == "buildwall")then
		grid[plr.gx][plr.gy] = {s=4,w=false}
		plr.menu = false
	elseif(choice == "buildarrow")then
		grid[plr.gx][plr.gy] = {s=6,w=false}
		plr.menu = false
	elseif(choice == "buildcannon")then
		grid[plr.gx][plr.gy] = {s=5,w=false}
		plr.menu = false
	end
	
		 
 
end

function d_menu()
	local x1, y1, x2, y2
	local pad = 3
	local lh = 7
	local g = 2
	local mw = 32
	local mh = (#options * lh) + (pad+1)	
	
	if plr.gx > (cols / 2) then
		x2 = (plr.gx*8) - g
		x1 = x2 - mw
	else
		x1 = (plr.gx*8)+7+g
		x2 = x1 + mw
	end
	if plr.gy > (rows / 2) then
		y2 = (plr.gy*8)+7 
  y1 = y2 - mh
 else
 	y1 = plr.gy*8
  y2 = y1 + mh
	end
	rectfill(x1, y1, x2, y2, 12)
	rect(x1, y1, x2, y2, 0)

	for i=1, #options do
		local ty = y1 + pad + ((i-1) * lh)
		print(options[i], x1 + pad, ty, 7)
		if option == i then
			spr(2, x1-5, ty-1)
		end
	end
end		
__gfx__
000000007707707700110000bbbbbbbb55555555bb8888bbbb8888bb000000000000000000000000000000000000000000000000000000000000000000000000
000000007000000701771000bbbbbbbb54444445b899998bb899998b000000000000000000000000000000000000000000000000000000000000000000000000
007007000000000017711110bbbbbbbb54444445899cc998899cc998000000000000000000000000000000000000000000000000000000000000000000000000
000770007000000787777771bbbbbbbb5444444589c9999889c99c98000000000000000000000000000000000000000000000000000000000000000000000000
000770007000000787776110bbbbbbbb5444444589c9999889cccc98000000000000000000000000000000000000000000000000000000000000000000000000
007007000000000087777100bbbbbbbb54444445899cc99889c99c98000000000000000000000000000000000000000000000000000000000000000000000000
000000007000000787776100bbbbbbbb54444445b899998bb899998b000000000000000000000000000000000000000000000000000000000000000000000000
000000007707707711111000bbbbbbbb55555555bb8888bbbb8888bb000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
